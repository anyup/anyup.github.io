(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-examples-ble"],{"1f78":function(e,t,i){(function(t){var n=i("dd7e").default,r=i("4cf1").default,a=i("46c5").default;function c(e){var t=(new Date).getTime();while((new Date).getTime()-t<e);}i("bf0f"),i("d4b5"),i("8f71"),i("f7a5"),i("aa9c"),i("18f7"),i("de6c"),i("c223"),e.exports={openBluetoothAdapter:function(){return new Promise((function(e,i){uni.openBluetoothAdapter({success:function(i){t.log("初始化蓝牙设备成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("初始化蓝牙设备失败",JSON.stringify(e)),i(e)}})}))},startBluetoothDevicesDiscovery:function(){return new Promise((function(e,i){uni.startBluetoothDevicesDiscovery({success:function(i){t.log("开始搜索蓝牙设备成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("开始搜索蓝牙设备失败",JSON.stringify(e)),i(e)}})}))},stopBluetoothDevicesDiscovery:function(e){return new Promise((function(e,i){uni.stopBluetoothDevicesDiscovery({success:function(i){t.log("停止搜索蓝牙设备成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("停止搜索蓝牙设备失败",JSON.stringify(e)),i(e)}})}))},getBluetoothDevices:function(){return new Promise((function(e,i){uni.getBluetoothDevices({success:function(t){var i=t.devices.filter((function(e){return e.localName}));e(i)},fail:function(e){t.log("获取蓝牙设备失败",JSON.stringify(e)),i(e)}})}))},getBluetoothAdapterState:function(){return new Promise((function(e,i){uni.getBluetoothAdapterState({success:function(i){t.log("获取本机蓝牙适配器状态成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("获取本机蓝牙适配器状态失败",JSON.stringify(e)),i(e)}})}))},createBLEConnection:function(e){var i=e.deviceId;return new Promise((function(e,n){uni.createBLEConnection({deviceId:i,success:function(i){t.log("连接低功耗蓝牙成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("连接低功耗蓝牙失败",JSON.stringify(e)),n(e)}})}))},closeBLEConnection:function(e){var i=e.deviceId;return new Promise((function(e,n){uni.closeBLEConnection({deviceId:i,success:function(i){t.log("断开低功耗蓝牙成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("断开低功耗蓝牙失败",JSON.stringify(e)),n(e)}})}))},getBLEDeviceServices:function(e){var i=e.deviceId;return new Promise((function(e,n){uni.getBLEDeviceServices({deviceId:i,success:function(i){t.log("获取设备服务成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("获取设备服务失败",JSON.stringify(e)),n(e)}})}))},getBLEDeviceCharacteristics:function(i){var n=i.deviceId,r=i.serviceId;return new Promise((function(i,a){uni.getBLEDeviceCharacteristics({deviceId:n,serviceId:r,success:function(a){for(var c in t.log("获取特征值成功",JSON.stringify(a)),i(a),a.characteristics){var s=a.characteristics[c],o=s.uuid,u=s.properties.notify;e.exports.notifyBLECharacteristicValueChange({deviceId:n,serviceId:r,characteristicId:o,notify:u})}},fail:function(e){t.log("获取特征值失败",JSON.stringify(e)),a(e)}})}))},notifyBLECharacteristicValueChange:function(e){var i=e.deviceId,n=e.serviceId,r=e.characteristicId,a=e.notify;return t.log({deviceId:i,serviceId:n,characteristicId:r,notify:a}),new Promise((function(e,c){a?uni.notifyBLECharacteristicValueChange({state:!0,deviceId:i,serviceId:n,characteristicId:r,success:function(i){t.log("启用蓝牙设备特征值notify成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("启用蓝牙设备特征值notify失败",JSON.stringify(e)),c(e)}}):c({msg:"not support notify"})}))},closeBluetoothAdapter:function(){return new Promise((function(e,i){uni.closeBluetoothAdapter({success:function(i){t.log("断开蓝牙模块成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("断开蓝牙模块失败",JSON.stringify(e)),i(e)}})}))},readBLECharacteristicValue:function(e){var i=e.deviceId,n=e.serviceId,r=e.characteristicId;return new Promise((function(e,a){uni.readBLECharacteristicValue({deviceId:i,serviceId:n,characteristicId:r,success:function(i){t.log("读取设备数据值成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("读取设备数据值失败",JSON.stringify(res)),a(e)}})}))},writeBLECharacteristicValue:function(e){var i=e.deviceId,n=e.serviceId,r=e.characteristicId,a=e.buffer;return new Promise((function(e,c){uni.writeBLECharacteristicValue({deviceId:i,serviceId:n,characteristicId:r,value:a,success:function(i){t.log("写入成功",JSON.stringify(i)),e(i)},fail:function(e){t.log("写入失败",JSON.stringify(e)),c(e)}})}))},getSliceBufferList:function(e){var t=0,i=e.byteLength,n=[];while(i>0){var r=void 0;i>20?(r=e.slice(t,t+20),t+=20,i-=20):(r=e.slice(t,t+i),t+=i,i-=i),n.push(r)}return n},writeBLEValueLoop:function(e){var i=this;return a(n().mark((function a(){var c,s,o,u,d,l,f,v;return n().wrap((function(a){while(1)switch(a.prev=a.next){case 0:c=e.deviceId,s=e.serviceId,o=e.characteristicId,u=e.buffer,3,d=i.getSliceBufferList(u),l=r(d),a.prev=4,v=n().mark((function e(){var r,a,u;return n().wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=f.value,a=0;case 2:if(!(a<=3)){e.next=23;break}return e.prev=3,e.next=6,i.writeBLECharacteristicValue({deviceId:c,serviceId:s,characteristicId:o,buffer:r});case 6:if(u=e.sent,!u){e.next=10;break}return t.log("Successfully sent ".concat(r)),e.abrupt("break",23);case 10:e.next=21;break;case 12:if(e.prev=12,e.t0=e["catch"](3),a++,t.error("Failed to send ".concat(r,", retrying... (").concat(a,"/").concat(3,")")),!(a>3)){e.next=19;break}return t.error("Max retries reached, failed to send ".concat(r,".")),e.abrupt("break",23);case 19:return e.next=21,new Promise((function(e){return setTimeout(e,500*a)}));case 21:e.next=2;break;case 23:case"end":return e.stop()}}),e,null,[[3,12]])})),l.s();case 7:if((f=l.n()).done){a.next=11;break}return a.delegateYield(v(),"t0",9);case 9:a.next=7;break;case 11:a.next=16;break;case 13:a.prev=13,a.t1=a["catch"](4),l.e(a.t1);case 16:return a.prev=16,l.f(),a.finish(16);case 19:t.log("All items sent successfully.");case 20:case"end":return a.stop()}}),a,null,[[4,13,16,19]])})))()},writeBLEValue:function(e){var t=e.deviceId,i=e.serviceId,n=e.characteristicId,r=e.buffer,a=0,s=r.byteLength;while(s>0){var o=void 0;c(90),s>20?(o=r.slice(a,a+20),a+=20,s-=20):(o=r.slice(a,a+s),a+=s,s-=s),this.writeBLECharacteristicValue({deviceId:t,serviceId:i,characteristicId:n,buffer:o})}}}}).call(this,i("ba7c")["default"])},"3a44":function(e,t,i){"use strict";i.r(t);var n=i("9507"),r=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},"3c03":function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,"uni-button[data-v-7c7e9fb1]{margin-top:%?30?%}.uni-title[data-v-7c7e9fb1]{text-align:center}.uni-mask[data-v-7c7e9fb1]{position:fixed;top:0;left:0;bottom:0;display:flex;align-items:center;width:100%;background:rgba(0,0,0,.6);padding:0 %?30?%;box-sizing:border-box;z-index:999}.uni-scroll_box[data-v-7c7e9fb1]{height:70%;background:#fff;border-radius:%?20?%}.uni-list-box[data-v-7c7e9fb1]{margin:0 %?20?%;padding:%?15?% 0;border-bottom:1px #f5f5f5 solid;box-sizing:border-box}.uni-list[data-v-7c7e9fb1]:last-child{border:none}.uni-list_name[data-v-7c7e9fb1]{font-size:%?30?%;color:#333}.uni-list_item[data-v-7c7e9fb1]{font-size:%?24?%;color:#555;line-height:1.5}.uni-success_box[data-v-7c7e9fb1]{position:absolute;left:0;bottom:0;min-height:%?100?%;width:100%;background:#fff;box-sizing:border-box;border-top:1px #eee solid}.uni-success_sub[data-v-7c7e9fb1]{\r\n  /* width: 100%%; */height:%?100?%;display:flex;justify-content:space-between;align-items:center;padding:0 %?30?%}.uni-close_button[data-v-7c7e9fb1]{padding:0 %?20?%;height:%?60?%;line-height:%?60?%;background:#ce3c39;color:#fff;border-radius:%?10?%}.uni-success_content[data-v-7c7e9fb1]{height:%?600?%;margin:%?30?%;margin-top:0;border:1px #eee solid;padding:%?30?%}.uni-content_list[data-v-7c7e9fb1]{padding-bottom:%?10?%;border-bottom:1px #f5f5f5 solid}.uni-tips[data-v-7c7e9fb1]{text-align:center;font-size:%?24?%;color:#666}",""]),e.exports=t},"45d5":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-uni-view",[e.isQuick?i("v-uni-view",[e.equipment.length>0?i("v-uni-view",[e._v(e._s((e.connected?"已连接设备":"已选择设备")+" : "+e.equipment[0].name+" ("+e.equipment[0].deviceId+")"))]):e._e(),i("v-uni-button",{staticClass:"is-mglr-20 is-mgtb-20",attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.quickInit.apply(void 0,arguments)}}},[e._v("连接蓝牙设备")]),i("v-uni-button",{staticClass:"is-mglr-20 is-mgtb-20",attrs:{type:"primary",disabled:!e.connected},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.closeBLEConnection.apply(void 0,arguments)}}},[e._v("断开蓝牙设备")]),i("v-uni-button",{staticClass:"is-mglr-20 is-mgtb-20",attrs:{type:"primary",disabled:!(e.connected&&e.characteristicId)},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$emit("print")}}},[e._v("开始打印")])],1):i("v-uni-view",{staticClass:"is-pd-20"},[i("v-uni-view",[e._v("本蓝牙协议只支持低功耗蓝牙协议ble。如果想连接非ble蓝牙设备，请在社区搜索 Native.js 蓝牙。")]),i("v-uni-view",{staticClass:"uni-btn-v"},[i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[0]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.openBluetoothAdapter.apply(void 0,arguments)}}},[e._v("初始化蓝牙模块")]),e.adapterState.available?e._e():i("v-uni-view",[e._v(e._s("蓝牙适配器不可用,请初始化蓝牙模块"))]),i("v-uni-button",{attrs:{type:"primary",loading:e.searchLoad,disabled:e.disabled[1]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.startBluetoothDevicesDiscovery.apply(void 0,arguments)}}},[e._v("开始搜索蓝牙设备")]),i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[2]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopBluetoothDevicesDiscovery(!1)}}},[e._v("停止搜索蓝牙设备")]),i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[3]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.queryDevices.apply(void 0,arguments)}}},[e._v("选择设备")]),e.equipment.length>0?i("v-uni-view",[e._v(e._s((e.connected?"已连接设备":"已选择设备")+" : "+e.equipment[0].name+" ("+e.equipment[0].deviceId+")"))]):e._e(),i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[4]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.createBLEConnection.apply(void 0,arguments)}}},[e._v("连接蓝牙设备")]),i("v-uni-view",[i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[5]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getBLEDeviceServices.apply(void 0,arguments)}}},[e._v("选择设备服务")]),e.servicesData.length>0?i("v-uni-view",[e._v("已选服务uuid："+e._s(e.servicesData[0].uuid))]):e._e()],1),i("v-uni-view",[i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[6]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.getBLEDeviceCharacteristics.apply(void 0,arguments)}}},[e._v("获取服务的特征值")]),e.characteristicsData.length>0?i("v-uni-view",[i("v-uni-view",{staticClass:"uni-list_name"},[e._v("uuid:"+e._s(e.characteristicsData[0].uuid))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 read 操作:"+e._s(e.characteristicsData[0].properties.read))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 write 操作:"+e._s(e.characteristicsData[0].properties.write))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 notify 操作:"+e._s(e.characteristicsData[0].properties.notify))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 indicate 操作:"+e._s(e.characteristicsData[0].properties.indicate))])],1):e._e()],1),i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[7]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.readBLECharacteristicValue.apply(void 0,arguments)}}},[e._v("读取特征值数据")]),e.valueChangeData.serviceId?i("v-uni-view",[i("v-uni-view",{staticClass:"list-name"},[e._v("特征值最新的值:"+e._s(e.bufValue(e.valueChangeData)||"还没有最新值"))])],1):e._e(),i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[9]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.closeBLEConnection.apply(void 0,arguments)}}},[e._v("断开蓝牙设备")]),i("v-uni-button",{attrs:{type:"primary",disabled:e.disabled[10]},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.closeBluetoothAdapter.apply(void 0,arguments)}}},[e._v("关闭蓝牙模块")])],1)],1),e.maskShow?i("v-uni-view",{staticClass:"uni-mask",on:{touchmove:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.moveHandle.apply(void 0,arguments)},click:function(t){arguments[0]=t=e.$handleEvent(t),e.maskShow=!1}}},[i("v-uni-scroll-view",{staticClass:"uni-scroll_box",attrs:{"scroll-y":!0},on:{touchmove:function(t){t.stopPropagation(),t.preventDefault(),arguments[0]=t=e.$handleEvent(t),e.moveHandle.apply(void 0,arguments)},click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.moveHandle.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"uni-title"},[e._v("已经发现"+e._s(e.list.length)+e._s("device"===e.showMaskType?"台设备":"个服务")+":")]),e._l(e.list,(function(t,n){return i("v-uni-view",{key:n,staticClass:"uni-list-box",on:{click:function(i){arguments[0]=i=e.$handleEvent(i),e.tapQuery(t)}}},["device"===e.showMaskType?i("v-uni-view",[i("v-uni-view",{staticClass:"uni-list_name"},[e._v(e._s(t.name||t.localName))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("信号强度:"+e._s(t.RSSI)+"dBm")]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("UUID:"+e._s(t.deviceId))]),"device"===e.showMaskType?i("v-uni-view",{staticClass:"list-item"},[e._v("Service数量:"+e._s(t.advertisServiceUUIDs.length))]):e._e()],1):e._e(),"service"===e.showMaskType?i("v-uni-view",[i("v-uni-view",{staticClass:"uni-list_item",staticStyle:{"line-height":"2.2"}},[e._v("UUID: "+e._s(t.uuid)),"service"===e.showMaskType?i("v-uni-text",[e._v(e._s(t.isPrimary?"（主服务）":""))]):e._e()],1)],1):e._e(),"characteristics"===e.showMaskType?i("v-uni-view",[i("v-uni-view",{staticClass:"uni-list_name"},[e._v("uuid:"+e._s(t.uuid))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 read 操作:"+e._s(t.properties.read))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 write 操作:"+e._s(t.properties.write))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 notify 操作:"+e._s(t.properties.notify))]),i("v-uni-view",{staticClass:"uni-list_item"},[e._v("是否支持 indicate 操作:"+e._s(t.properties.indicate))])],1):e._e()],1)}))],2)],1):e._e()],1)},r=[]},"46c5":function(e,t,i){function n(e,t,i,n,r,a,c){try{var s=e[a](c),o=s.value}catch(u){return void i(u)}s.done?t(o):Promise.resolve(o).then(n,r)}i("bf0f"),e.exports=function(e){return function(){var t=this,i=arguments;return new Promise((function(r,a){var c=e.apply(t,i);function s(e){n(c,r,a,s,o,"next",e)}function o(e){n(c,r,a,s,o,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports["default"]=e.exports},"4cf1":function(e,t,i){i("01a2"),i("e39c"),i("bf0f"),i("844d"),i("18f7"),i("de6c"),i("7a76"),i("c9b5");var n=i("79b7");e.exports=function(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=n(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,c=e},f:function(){try{s||null==i["return"]||i["return"]()}finally{if(o)throw c}}}},e.exports.__esModule=!0,e.exports["default"]=e.exports},"51b4":function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"a",(function(){return n}));var n={appLayout:i("4bae").default,configDemo:i("57d3").default,bleConnect:i("73e10").default},r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("app-layout",[i("config-demo",{attrs:{list:[],tips:"低功耗蓝牙连接 API 演示"}},[i("ble-connect",{ref:"ble",attrs:{"is-quick":!1},on:{print:function(t){arguments[0]=t=e.$handleEvent(t),e.print()}}})],1)],1)},a=[]},"6c3b":function(e,t,i){"use strict";i.r(t);var n=i("51b4"),r=i("3a44");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a);var c=i("828b"),s=Object(c["a"])(r["default"],n["b"],n["c"],!1,null,"1f981314",null,!1,n["a"],void 0);t["default"]=s.exports},"73e10":function(e,t,i){"use strict";i.r(t);var n=i("45d5"),r=i("d447");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a);i("c352");var c=i("828b"),s=Object(c["a"])(r["default"],n["b"],n["c"],!1,null,"7c7e9fb1",null,!1,n["a"],void 0);t["default"]=s.exports},"79b7":function(e,t,i){i("f7a5"),i("bf0f"),i("08eb"),i("18f7"),i("5c47"),i("0506");var n=i("e476");e.exports=function(e,t){if(e){if("string"===typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports["default"]=e.exports},9507:function(e,t,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(i("2634")),a=n(i("2fdc")),c={data:function(){return{}},methods:{print:function(){var e=this;return(0,a.default)((0,r.default)().mark((function t(){var i;return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$tips.loading("打印中..."),i=(new Printer).setAlign("ct").setSize(1,2).print("居中标题").setAlign("lt").setSize(1,1).printFill().printLR("左侧文字","右侧文字").printLCR("左侧文字","中间文字","右侧文字").printFill().print("打印时间："+e.$_u.formatTime((new Date).getTime(),"yyyy-MM-dd hh:mm:ss")).println().setSize(2,2).print("二倍放大：").setSize(1,1).end(),!e.$refs||!e.$refs.ble){t.next=5;break}return t.next=5,e.$refs.ble.writeBLEValueLoop(i);case 5:setTimeout((function(){e.$tips.loaded()}),1e3);case 6:case"end":return t.stop()}}),t)})))()}}};t.default=c},c352:function(e,t,i){"use strict";var n=i("cad3"),r=i.n(n);r.a},cad3:function(e,t,i){var n=i("3c03");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("967d").default;r("d4b13482",n,!0,{sourceMap:!1,shadowMode:!1})},d447:function(e,t,i){"use strict";i.r(t);var n=i("fdb8"),r=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=r.a},dd7e:function(e,t,i){i("6a54"),i("01a2"),i("e39c"),i("bf0f"),i("844d"),i("18f7"),i("de6c"),i("3872e"),i("4e9b"),i("114e"),i("c240"),i("926e"),i("7a76"),i("c9b5"),i("aa9c"),i("2797"),i("8a8d"),i("dc69"),i("f7a5");var n=i("bdbb")["default"];function r(){"use strict";
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=r=function(){return t},e.exports.__esModule=!0,e.exports["default"]=e.exports;var t={},i=Object.prototype,a=i.hasOwnProperty,c=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",d=s.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch($){l=function(e,t,i){return e[t]=i}}function f(e,t,i,n){var r=t&&t.prototype instanceof p?t:p,a=Object.create(r.prototype),s=new D(n||[]);return c(a,"_invoke",{value:x(e,i,s)}),a}function v(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch($){return{type:"throw",arg:$}}}t.wrap=f;var h={};function p(){}function g(){}function b(){}var y={};l(y,o,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(k([])));w&&w!==i&&a.call(w,o)&&(y=w);var I=b.prototype=p.prototype=Object.create(y);function _(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){var i;c(this,"_invoke",{value:function(r,c){function s(){return new t((function(i,s){(function i(r,c,s,o){var u=v(e[r],e,c);if("throw"!==u.type){var d=u.arg,l=d.value;return l&&"object"==n(l)&&a.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,s,o)}),(function(e){i("throw",e,s,o)})):t.resolve(l).then((function(e){d.value=e,s(d)}),(function(e){return i("throw",e,s,o)}))}o(u.arg)})(r,c,i,s)}))}return i=i?i.then(s,s):s()}})}function x(e,t,i){var n="suspendedStart";return function(r,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===r)throw a;return S()}for(i.method=r,i.arg=a;;){var c=i.delegate;if(c){var s=L(c,i);if(s){if(s===h)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var o=v(e,t,i);if("normal"===o.type){if(n=i.done?"completed":"suspendedYield",o.arg===h)continue;return{value:o.arg,done:i.done}}"throw"===o.type&&(n="completed",i.method="throw",i.arg=o.arg)}}}function L(e,t){var i=t.method,n=e.iterator[i];if(void 0===n)return t.delegate=null,"throw"===i&&e.iterator["return"]&&(t.method="return",t.arg=void 0,L(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var r=v(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function k(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(a.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:S}}function S(){return{value:void 0,done:!0}}return g.prototype=b,c(I,"constructor",{value:b,configurable:!0}),c(b,"constructor",{value:g,configurable:!0}),g.displayName=l(b,d,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,d,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},_(C.prototype),l(C.prototype,u,(function(){return this})),t.AsyncIterator=C,t.async=function(e,i,n,r,a){void 0===a&&(a=Promise);var c=new C(f(e,i,n,r),a);return t.isGeneratorFunction(i)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},_(I),l(I,d,"Generator"),l(I,o,(function(){return this})),l(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=k,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(B),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,n){return c.type="throw",c.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],c=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=a.call(r,"catchLoc"),o=a.call(r,"finallyLoc");if(s&&o){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var c=r?r.completion:{};return c.type=e,c.arg=t,r?(this.method="next",this.next=r.finallyLoc,h):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),B(i),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;B(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:k(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},e476:function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n},e.exports.__esModule=!0,e.exports["default"]=e.exports},fdb8:function(e,t,i){"use strict";(function(e){i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("aa9c"),i("8f71"),i("bf0f"),i("d4b5"),i("c223"),i("fd3c"),i("4db2"),i("c976"),i("4d8f"),i("7b97"),i("668a"),i("c5b7"),i("8ff5"),i("2378"),i("641a"),i("64e0"),i("cce3"),i("efba"),i("d009"),i("bd7d"),i("7edd"),i("d798"),i("f547"),i("5e54"),i("b60a"),i("8c18"),i("12973"),i("f991"),i("198e"),i("8557"),i("63b1"),i("1954"),i("1cf1"),i("f7a5"),i("c9b5"),i("ab80");var r=n(i("2634")),a=n(i("2fdc")),c=n(i("1f78")),s={props:{serviceId:{type:String,default:""},characteristicId:{type:String,default:""},isQuick:{type:[String,Boolean],default:!1},filterName:{type:String,default:""}},data:function(){return{disabled:[!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],searchLoad:!1,maskShow:!1,equipment:[],adapterState:{discovering:!1,available:!1},connected:!1,showMaskType:"device",servicesData:[],characteristicsData:[],valueChangeData:{},isStop:!0,list:[]}},created:function(){this.onBLEConnectionStateChange()},destroyed:function(){this.closeBLEConnection(),this.closeBluetoothAdapter(!0)},watch:{equipment:{handler:function(e,t){var i=this.getIds(),n=i.deviceId;this.$emit("deviceId",n)},deep:!0},servicesData:{handler:function(e,t){var i=this.getIds(),n=i.serviceId;this.$emit("serviceId",n)},deep:!0},characteristicsData:{handler:function(e,t){var i=this.getIds(),n=i.characteristicId;this.$emit("characteristicId",n)},deep:!0}},computed:{bufValue:function(){return function(e){return e.value}}},methods:{moveHandle:function(){},quickInit:function(){var e=this;return(0,a.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.openBluetoothAdapter();case 2:return t.next=4,e.startBluetoothDevicesDiscovery();case 4:e.queryDevices();case 5:case"end":return t.stop()}}),t)})))()},getIds:function(){if(this.isQuick){var e=this.equipment.length?this.equipment[0].deviceId:"",t=this.serviceId,i=this.characteristicId;return{deviceId:e,serviceId:t,characteristicId:i,notify:!0}}var n=this.equipment.length?this.equipment[0].deviceId:"",r=this.servicesData.length?this.servicesData[0].uuid:"",a=this.characteristicsData.length?this.characteristicsData[0].uuid:"",c=!!this.characteristicsData.length&&this.characteristicsData[0].properties.notify;return{deviceId:n,serviceId:r,characteristicId:a,notify:c}},queryDevices:function(){this.showMaskType="device",this.maskShow=!0},tapQuery:function(e){"device"===this.showMaskType&&(this.$set(this.disabled,4,!1),this.equipment.length>0?this.equipment[0]=e:this.equipment.push(e),this.isQuick&&this.createBLEConnection()),"service"===this.showMaskType&&(this.$set(this.disabled,6,!1),this.servicesData.length>0?this.servicesData[0]=e:this.servicesData.push(e)),"characteristics"===this.showMaskType&&(this.$set(this.disabled,7,!1),this.$set(this.disabled,8,!1),this.characteristicsData.length>0?this.characteristicsData[0]=e:this.characteristicsData.push(e)),this.maskShow=!1},openBluetoothAdapter:function(){var e=this;c.default.openBluetoothAdapter().then((function(t){e.isStop=!1,e.$set(e.disabled,0,!0),e.$set(e.disabled,1,!1),e.$set(e.disabled,10,!1),e.getBluetoothAdapterState()})).catch((function(e){0!==e.errCode&&o(e.errCode,e.errMsg)}))},getBluetoothAdapterState:function(){var e=this;c.default.getBluetoothAdapterState().then((function(t){e.adapterState=t})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},startBluetoothDevicesDiscovery:function(){var e=this;c.default.startBluetoothDevicesDiscovery().then((function(t){e.searchLoad=!0,e.$set(e.disabled,1,!0),e.$set(e.disabled,2,!1),e.$set(e.disabled,3,!1),e.onBluetoothDeviceFound()})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},onBluetoothDeviceFound:function(){var e=this;uni.onBluetoothDeviceFound((function(t){e.getBluetoothDevices()}))},getBluetoothDevices:function(){var e=this;c.default.getBluetoothDevices().then((function(t){e.list=t.filter((function(t){return!e.filterName||t.name===e.filterName}))})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},createBLEConnection:function(){var e=this,t=this.getIds(),i=t.deviceId;uni.showToast({title:"连接蓝牙...",icon:"loading",duration:99999}),c.default.createBLEConnection({deviceId:i}).then((function(t){e.stopBluetoothDevicesDiscovery(!0),uni.hideToast(),uni.showToast({title:"连接成功",icon:"success",duration:2e3}),e.$set(e.disabled,3,!0),e.$set(e.disabled,4,!0),e.$set(e.disabled,5,!1),e.$set(e.disabled,9,!1),e.connected=!0,e.$emit("connected",i)})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},stopBluetoothDevicesDiscovery:function(e){var t=this;c.default.stopBluetoothDevicesDiscovery().then((function(i){e?t.$set(t.disabled,1,!0):t.$set(t.disabled,1,!1),t.$set(t.disabled,2,!0),t.searchLoad=!1})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},closeBLEConnection:function(){var e=this,t=this.getIds(),i=t.deviceId;i&&c.default.closeBLEConnection({deviceId:i}).then((function(t){e.$set(e.disabled,1,!1),e.$set(e.disabled,3,!0),e.$set(e.disabled,4,!0),e.$set(e.disabled,5,!0),e.$set(e.disabled,6,!0),e.$set(e.disabled,7,!0),e.$set(e.disabled,8,!0),e.$set(e.disabled,9,!0),e.equipment=[],e.servicesData=[],e.characteristicsData=[],e.connected=!1})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},getBLEDeviceServices:function(){var e=this,t=this.getIds(),i=t.deviceId;c.default.getBLEDeviceServices({deviceId:i}).then((function(t){e.$set(e.disabled,7,!0),e.$set(e.disabled,8,!0),e.showMaskType="service",e.list=t.services,e.characteristicsData=[],e.list.length<=0?u("获取服务失败，请重试!"):e.maskShow=!0})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},getBLEDeviceCharacteristics:function(){var e=this,t=this.getIds(),i=t.deviceId,n=t.serviceId;c.default.getBLEDeviceCharacteristics({deviceId:i,serviceId:n}).then((function(t){e.$set(e.disabled,7,!0),e.valueChangeData={},e.showMaskType="characteristics",e.list=t.characteristics,e.list.length<=0?u("获取特征值失败，请重试!"):e.maskShow=!0})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},onBLEConnectionStateChange:function(){var t=this;uni.onBLEConnectionStateChange((function(i){if(e.log("监听蓝牙连接状态",JSON.stringify(i)),!i.connected){if(t.isStop)return;e.log("断开低功耗蓝牙成功:"),t.$set(t.disabled,1,!1),t.$set(t.disabled,3,!0),t.$set(t.disabled,4,!0),t.$set(t.disabled,5,!0),t.$set(t.disabled,6,!0),t.$set(t.disabled,7,!0),t.$set(t.disabled,8,!0),t.$set(t.disabled,9,!0),t.searchLoad=!1,t.equipment=[],t.servicesData=[],t.characteristicsData=[],t.valueChangeData={},u("已经断开当前蓝牙连接")}}))},readBLECharacteristicValue:function(){var e=this,t=this.getIds(),i=t.deviceId,n=t.serviceId,r=t.characteristicId;this.onBLECharacteristicValueChange(),c.default.readBLECharacteristicValue({deviceId:i,serviceId:n,characteristicId:r}).then((function(t){e.notifyBLECharacteristicValueChange()})).catch((function(e){0!==e.errCode&&o(e.errCode)}))},writeBLECharacteristicValue:function(e){var t=this.getIds(),i=t.deviceId,n=t.serviceId,r=t.characteristicId;return this.onBLECharacteristicValueChange(),c.default.writeBLECharacteristicValue({deviceId:i,serviceId:n,characteristicId:r,buffer:e})},writeBLEValue:function(t){var i=this.getIds(),n=i.deviceId,r=i.serviceId,a=i.characteristicId;return e.log({deviceId:n,serviceId:r,characteristicId:a}),this.onBLECharacteristicValueChange(),c.default.writeBLEValue({deviceId:n,serviceId:r,characteristicId:a,buffer:t})},writeBLEValueLoop:function(t){e.log(t);var i=this.getIds(),n=i.deviceId,r=i.serviceId,a=i.characteristicId;return e.log({deviceId:n,serviceId:r,characteristicId:a}),this.onBLECharacteristicValueChange(),c.default.writeBLEValueLoop({deviceId:n,serviceId:r,characteristicId:a,buffer:t})},onBLECharacteristicValueChange:function(){var t=this;uni.onBLECharacteristicValueChange((function(i){e.log("监听低功耗蓝牙设备的特征值变化事件成功"),e.log(JSON.stringify(i)),e.log("characteristic ".concat(i.characteristicId," has changed, now is ").concat(i.value)),e.log("16进制值 ".concat(function(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)}));return t.join("")}(i.value))),t.valueChangeData=i}))},notifyBLECharacteristicValueChange:function(){var e=this.getIds(),t=e.deviceId,i=e.serviceId,n=e.characteristicId,r=e.notify;c.default.notifyBLECharacteristicValueChange(t,i,n,r).then((function(e){}))},closeBluetoothAdapter:function(){var e=this;c.default.closeBluetoothAdapter().then((function(t){e.isStop=!0,e.$set(e.disabled,0,!1),e.$set(e.disabled,1,!0),e.$set(e.disabled,2,!0),e.$set(e.disabled,3,!0),e.$set(e.disabled,4,!0),e.$set(e.disabled,5,!0),e.$set(e.disabled,6,!0),e.$set(e.disabled,7,!0),e.$set(e.disabled,8,!0),e.$set(e.disabled,9,!0),e.$set(e.disabled,10,!0),e.equipment=[],e.servicesData=[],e.characteristicsData=[],e.valueChangeData={},e.adapterState=[],e.searchLoad=!1}))}}};function o(e,t){switch(e){case 1e4:u("未初始化蓝牙适配器");break;case 10001:u("未检测到蓝牙，请打开蓝牙重试！");break;case 10002:u("没有找到指定设备");break;case 10003:u("连接失败");break;case 10004:u("没有找到指定服务");break;case 10005:u("没有找到指定特征值");break;case 10006:u("当前连接已断开");break;case 10007:u("当前特征值不支持此操作");break;case 10008:u("其余所有系统上报的异常");break;case 10009:u("Android 系统特有，系统版本低于 4.3 不支持 BLE");break;default:u(t)}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];uni.showModal({title:"提示",content:e,showCancel:t})}t.default=s}).call(this,i("ba7c")["default"])}}]);